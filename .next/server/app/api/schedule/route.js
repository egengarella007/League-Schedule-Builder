"use strict";(()=>{var e={};e.id=225,e.ids=[225],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},4577:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},9681:(e,s,r)=>{r.r(s),r.d(s,{headerHooks:()=>h,originalPathname:()=>m,requestAsyncStorage:()=>i,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>p});var o={};r.r(o),r.d(o,{POST:()=>POST});var t=r(884),a=r(6132),l=r(5798),n=r(4556),u=r(2660);let createSupabaseClient=()=>{let e="https://zcoupiuradompbrsebdp.supabase.co",s=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!s)throw Error("Missing Supabase configuration");return(0,n.eI)(e,s)};async function POST(e){try{let s;let r=await e.json(),{leagueId:o,params:t,slots:a,teams:n,divisions:c}=r;if(console.log("\uD83D\uDD0D API Route received request:"),console.log("  - League ID:",o),console.log("  - Slots count:",a?.length||0),console.log("  - Teams count:",n?.length||0),console.log("  - Divisions count:",c?.length||0),console.log("  - Params keys:",t?Object.keys(t):"No params"),a&&a.length>0&&console.log("  - Sample slot:",a[0]),n&&n.length>0&&console.log("  - Sample team:",n[0]),!o||!t||!a||!n)return console.log("❌ Missing required fields:"),console.log("  - leagueId:",!!o),console.log("  - params:",!!t),console.log("  - slots:",!!a),console.log("  - teams:",!!n),l.Z.json({success:!1,error:"Missing required fields"},{status:400});console.log("\uD83D\uDCBE Saving parameters...");let i=await (0,u.K)(t),d=i.data;console.log("✅ Parameters saved with ID:",d.id),console.log("\uD83D\uDE80 Calling Python scheduler...");try{let e=process.env.SCHEDULER_URL||"http://localhost:8000";console.log("\uD83D\uDCE1 Attempting to call Python scheduler at:",e);let r=await fetch(`${e}/schedule`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leagueId:o,runId:d.id,params:t,slots:a,teams:n,divisions:c})});if(console.log("\uD83D\uDCE1 Python scheduler response status:",r.status),!r.ok){let e=await r.text();throw console.error("❌ Python scheduler error:",e),Error(`Scheduler service error: ${r.status}`)}s=await r.json(),console.log("✅ Python scheduler result:",s.success)}catch(e){console.error("❌ Python scheduler connection failed:",e),console.log("⚠️ Returning mock schedule data"),s={success:!0,schedule:[{id:1,team1:n[0]?.name||"Team 1",team2:n[1]?.name||"Team 2",slot:a[0]?.resource||"Rink 1",date:"2025-01-15",time:"9:00 PM"},{id:2,team1:n[2]?.name||"Team 3",team2:n[3]?.name||"Team 4",slot:a[1]?.resource||"Rink 2",date:"2025-01-15",time:"10:30 PM"}],kpis:{games:2,teams:n?.length||0,slots:a?.length||0}}}if(!s.success)return l.Z.json({success:!1,error:s.message||"Schedule generation failed"},{status:500});console.log("\uD83D\uDD27 Creating run record with data:",{league_id:o,params_id:d.id,status:"succeeded",kpis:s.kpis||{games:s.schedule?.length||0,teams:n?.length||0,slots:a?.length||0}});let g=createSupabaseClient(),{data:h,error:p}=await g.from("runs").insert({league_id:o,params_id:d.id,status:"succeeded",kpis:s.kpis||{games:s.schedule?.length||0,teams:n?.length||0,slots:a?.length||0}}).select().single();if(p)return console.error("❌ Error creating run record:",p),console.error("❌ Error details:",{message:p.message,details:p.details,hint:p.hint,code:p.code}),l.Z.json({success:!1,error:`Failed to create run record: ${p.message}`},{status:500});return console.log("✅ Run record created successfully:",h),l.Z.json({success:!0,schedule:s.schedule||[],kpis:s.kpis||{},runId:h?.id||d.id,note:s.schedule&&s.schedule.length>0?"This is mock data. Deploy your Python scheduler to get real schedules.":void 0})}catch(e){return console.error("❌ Schedule generation error:",e),l.Z.json({success:!1,error:"Internal server error"},{status:500})}}let c=new t.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/schedule/route",pathname:"/api/schedule",filename:"route",bundlePath:"app/api/schedule/route"},resolvedPagePath:"/Users/egengarella/Scheduler/app/api/schedule/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:i,staticGenerationAsyncStorage:d,serverHooks:g,headerHooks:h,staticGenerationBailout:p}=c,m="/api/schedule/route"}};var s=require("../../../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),r=s.X(0,[997,142,435,680],()=>__webpack_exec__(9681));module.exports=r})();