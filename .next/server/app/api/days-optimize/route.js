"use strict";(()=>{var e={};e.id=566,e.ids=[566],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1017:e=>{e.exports=require("path")},337:(e,t,o)=>{o.r(t),o.d(t,{headerHooks:()=>h,originalPathname:()=>g,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>u,staticGenerationBailout:()=>y});var r={};o.r(r),o.d(r,{POST:()=>POST});var s=o(884),a=o(6132),i=o(5798);let n=require("child_process");var l=o(1017),d=o.n(l);async function POST(e){try{let t=await e.json(),{schedule_data:o,late_threshold:r="22:31"}=t;if(!o)return i.Z.json({error:"Missing schedule_data parameter"},{status:400});console.log("\uD83D\uDE80 Starting Days Since Last Played optimization..."),console.log(`ðŸ“Š Schedule data: ${o.buckets?.length||0} buckets`),console.log(`â° Late threshold: ${r}`);let s={schedule_data:o,late_threshold:r},a=d().join(process.cwd(),"scheduler_api","days_since_optimizer.py");return new Promise(e=>{let t=(0,n.spawn)("python3",[a],{stdio:["pipe","pipe","pipe"]}),o="",r="";t.stdin.write(JSON.stringify(s)),t.stdin.end(),t.stdout.on("data",e=>{o+=e.toString()}),t.stderr.on("data",e=>{r+=e.toString(),console.log(`ðŸ Python stderr: ${e.toString()}`)}),t.on("close",t=>{if(console.log(`ðŸ Python process exited with code ${t}`),0!==t){console.error("âŒ Python script failed"),console.error("Stderr output:",r),e(i.Z.json({error:"Days optimization failed",details:`Python script failed with code ${t}. Stderr: ${r}`},{status:500}));return}try{let t=JSON.parse(o);if(!t.success){console.error("âŒ Python script returned error:",t.error),e(i.Z.json({error:"Days optimization failed",details:t.error},{status:500}));return}console.log("âœ… Days optimization completed successfully!"),console.log(`ðŸ“Š Total changes made: ${t.total_changes}`),e(i.Z.json({success:!0,message:"Days optimization completed successfully",optimized_schedule:t.optimized_schedule,changes_made:t.changes_made,total_changes:t.total_changes}))}catch(t){console.error("âŒ Failed to parse Python output:",t),console.error("Raw stdout:",o),e(i.Z.json({error:"Days optimization failed",details:`Failed to parse Python output: ${t}. Raw output: ${o}`},{status:500}))}}),t.on("error",t=>{console.error("âŒ Failed to start Python process:",t),e(i.Z.json({error:"Days optimization failed",details:`Failed to start Python process: ${t.message}`},{status:500}))}),setTimeout(()=>{t.kill(),e(i.Z.json({error:"Days optimization failed",details:"Process timed out after 60 seconds"},{status:500}))},6e4)})}catch(e){return console.error("âŒ Error in days optimization API:",e),i.Z.json({error:"Days optimization failed",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/days-optimize/route",pathname:"/api/days-optimize",filename:"route",bundlePath:"app/api/days-optimize/route"},resolvedPagePath:"/Users/egengarella/Scheduler/app/api/days-optimize/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:u,serverHooks:m,headerHooks:h,staticGenerationBailout:y}=c,g="/api/days-optimize/route"}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),o=t.X(0,[997],()=>__webpack_exec__(337));module.exports=o})();