"use strict";(()=>{var e={};e.id=27,e.ids=[27],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6768:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>d,originalPathname:()=>h,requestAsyncStorage:()=>l,routeModule:()=>n,serverHooks:()=>c,staticGenerationAsyncStorage:()=>u,staticGenerationBailout:()=>p});var r={};a.r(r),a.d(r,{POST:()=>POST});var i=a(884),o=a(6132),s=a(5798);async function POST(e){try{let t=await e.json(),{schedule:a,blockSize:r,blockRecipe:i,earlyStart:o,midStart:n,earlyEnd:l,midEnd:u,defaultGameMinutes:c,weights:d,wGlobal:p,wRolling:h,wRepeat:m,wDispersion:g,wLateFairness:w,globalSlack:y,rollingSlack:_,maxPasses:P,dryRun:k,optimize_days_since:v,force_full_validation:S}=t;if(console.log("\uD83D\uDD27 Optimization request received:",{gamesCount:a?.length,blockSize:r,blockRecipe:i,earlyStart:o||l,midStart:n||u,target_week:t.target_week,optimize_days_since:v,force_full_validation:S,dryRun:k}),!a||!Array.isArray(a)||0===a.length)return s.Z.json({error:"Invalid schedule data"},{status:400});let f={schedule:a.map(e=>({id:e.id,start:e.start,end:e.end,rink:e.rink,div:e.div,home:e.home,away:e.away})),blockSize:r||10,blockRecipe:i||{a:6,b:4},earlyStart:o||"10:01 PM",midStart:n||"10:31 PM",target_week:t.target_week,defaultGameMinutes:c||80,weights:d||{w_eml:1,w_runs:.2,w_rest:.6},wGlobal:p||2,wRolling:h||1.2,wRepeat:m||1,wDispersion:g||.6,wLateFairness:w||1,globalSlack:y||1,rollingSlack:_||0,maxPasses:P||3,dryRun:!1!==k,optimize_days_since:!1!==v,force_full_validation:!1!==S},b=await callPythonScheduler(f);return console.log("✅ Optimization completed:",{swapsCount:b.swaps?.length||0,scoreImprovements:b.score_after}),s.Z.json(b)}catch(e){return console.error("❌ Optimization error:",e),s.Z.json({error:"Optimization failed",details:e.message},{status:500})}}async function callPythonScheduler(e){try{let t=process.env.SCHEDULER_URL||"https://league-schedule-builder-1068724512018.europe-west1.run.app";console.log("\uD83D\uDD27 Calling Python scheduler at:",t);let a=await fetch(`${t}/optimize`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){let e=await a.text();throw Error(`Python scheduler responded with ${a.status}: ${e}`)}let r=await a.json();return r}catch(e){return console.error("❌ Failed to call Python scheduler:",e),{error:"Python scheduler unavailable",message:"Optimization service is currently unavailable. Please try again later.",fallback:!0}}}let n=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/optimize/route",pathname:"/api/optimize",filename:"route",bundlePath:"app/api/optimize/route"},resolvedPagePath:"/Users/egengarella/Scheduler/app/api/optimize/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:u,serverHooks:c,headerHooks:d,staticGenerationBailout:p}=n,h="/api/optimize/route"}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[997],()=>__webpack_exec__(6768));module.exports=a})();